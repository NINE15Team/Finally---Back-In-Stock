(()=>{var j=Object.create;var b=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var w=(a,i)=>()=>(a&&(i=a(a=0)),i);var C=(a,i)=>()=>(i||a((i={exports:{}}).exports,i),i.exports);var U=(a,i,r,p)=>{if(i&&typeof i=="object"||typeof i=="function")for(let l of J(i))!A.call(a,l)&&l!==r&&b(a,l,{get:()=>i[l],enumerable:!(p=L(i,l))||p.enumerable});return a};var V=(a,i,r)=>(r=a!=null?j(R(a)):{},U(i||!a||!a.__esModule?b(r,"default",{value:a,enumerable:!0}):r,a));var m=(a,i,r)=>new Promise((p,l)=>{var g=u=>{try{f(r.next(u))}catch(_){l(_)}},h=u=>{try{f(r.throw(u))}catch(_){l(_)}},f=u=>u.done?p(u.value):Promise.resolve(u.value).then(g,h);f((r=r.apply(a,i)).next())});var k,$=w(()=>{k="WebPixel::Render"});var v,O=w(()=>{$();v=a=>shopify.extend(k,a)});var T=w(()=>{O()});var N=w(()=>{T()});var E=C(y=>{"use strict";N();var S="https://mate-chi-kirk-intensive.trycloudflare.com";v(({configuration:a,analytics:i,browser:r,init:p})=>{i.subscribe("product_viewed",t=>m(y,null,function*(){let e=l(p.context.document.location.search,"fbis"),c=l(p.context.document.location.search,"email"),s=yield h(`${e}_view`);if(console.log(e,c),e)if(s)console.log("View!!");else{let o=t.data.productVariant.id,d=t.data.productVariant.product.id,n=yield fetch(`${S}/api/customer_activity`,{method:"POST",body:JSON.stringify([{productId:d,variantId:o,shopifyURL:location.host,uuid:e,customerEmail:c,browserTrackId:t.clientId,status:"view"}])}).then(I=>I.json());n.success?(yield g(`${e}_view`,o,30),yield g(`${e}_view_email`,c,30),yield g(o,e),yield u(t.clientId,"fbis_viewed",d,o,e,c)):console.error(n.message)}})),i.subscribe("product_added_to_cart",t=>m(y,null,function*(){console.log(t);let e=t.data.cartLine.merchandise.id,c=t.data.cartLine.merchandise.product.id,s=yield f(e),o=yield f(`${s}_view`),d=yield f(`${s}_view_email`),n=yield h(`${s}_cart`);if(console.log(s,o,d,!n,e,o==e),s&&!n&&o==e){let I=yield fetch(`${S}/api/customer_activity`,{method:"POST",body:JSON.stringify([{productId:c,variantId:t.data.cartLine.merchandise.id,shopifyURL:location.host,uuid:s,browserTrackId:t.clientId,customerEmail:d,status:"add_to_cart"}])}).then(P=>P.json());I.success?(yield g(`${s}_cart`,e,30),yield u(t.clientId,"fbis_added_to_cart",c,e,s,d)):console.error(I.message)}else console.log("Add to Cart!!")})),i.subscribe("product_removed_from_cart",t=>{console.log("Product Removed!!",t)}),i.subscribe("checkout_completed",t=>m(y,null,function*(){let e=yield _(t.clientId,"fbis_added_to_cart");if(e){let c=[];e.forEach(o=>{c.push({productId:o.productId,variantId:o.variantId,shopifyURL:location.host,uuid:o.uuid,browserTrackId:t.clientId,customerEmail:o.email,status:"completed"})});let s=yield fetch(`${S}/api/customer_activity`,{method:"POST",body:JSON.stringify(c)}).then(o=>o.json());yield x(t.clientId)}console.log(t)}));function l(t,e){let c=t.substring(1).split("&"),s={};return c.forEach(o=>{let[d,n]=o.split("=");s[d]=n}),s[e]}function g(t,e,c,s="/"){return m(this,null,function*(){let o=new Date;o.setTime(o.getTime()+c*24*60*60*1e3);let d="expires="+o.toUTCString();yield r.cookie.set(`${t}=${e}; ${d}; path=${s}`)})}function h(t){return m(this,null,function*(){let e=yield r.cookie.get(t);return e!=null&&e!=null&&e.length>0})}function f(t){return m(this,null,function*(){return yield r.cookie.get(t)})}function u(t,e,c,s,o,d){return m(this,null,function*(){try{let n=JSON.parse(yield r.sessionStorage.getItem(t))||{};n[e]||(n[e]=[]),n[e].push({uuid:o,productId:c,variantId:s,email:d}),yield r.sessionStorage.setItem(t,JSON.stringify(n))}catch(n){console.error("Data error",n)}})}function _(t,e){return m(this,null,function*(){let c=yield r.sessionStorage.getItem(t);if(c)return JSON.parse(c)[e]})}function x(t){return m(this,null,function*(){yield r.sessionStorage.removeItem(t)})}})});var Q=V(E());})();
