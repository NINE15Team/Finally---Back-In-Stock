(()=>{var j=Object.create;var S=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var w=(o,i)=>()=>(o&&(i=o(o=0)),i);var C=(o,i)=>()=>(i||o((i={exports:{}}).exports,i),i.exports);var U=(o,i,r,m)=>{if(i&&typeof i=="object"||typeof i=="function")for(let l of J(i))!A.call(o,l)&&l!==r&&S(o,l,{get:()=>i[l],enumerable:!(m=L(i,l))||m.enumerable});return o};var V=(o,i,r)=>(r=o!=null?j(R(o)):{},U(i||!o||!o.__esModule?S(r,"default",{value:o,enumerable:!0}):r,o));var p=(o,i,r)=>new Promise((m,l)=>{var g=u=>{try{f(r.next(u))}catch(_){l(_)}},h=u=>{try{f(r.throw(u))}catch(_){l(_)}},f=u=>u.done?m(u.value):Promise.resolve(u.value).then(g,h);f((r=r.apply(o,i)).next())});var k,$=w(()=>{k="WebPixel::Render"});var v,O=w(()=>{$();v=o=>shopify.extend(k,o)});var T=w(()=>{O()});var N=w(()=>{T()});var E=C(y=>{"use strict";N();var b="https://finally-back-in-stock-backend-d0ae88a21a21.herokuapp.com";v(({configuration:o,analytics:i,browser:r,init:m})=>{i.subscribe("product_viewed",t=>p(y,null,function*(){let e=l(m.context.document.location.search,"fbis"),c=l(m.context.document.location.search,"email"),s=yield h(`${e}_view`);if(console.log(e,c),e)if(s)console.log("View!!");else{let a=t.data.productVariant.id,d=t.data.productVariant.product.id,n=yield fetch(`${b}/api/customer_activity`,{method:"POST",body:JSON.stringify([{productId:d,variantId:a,shopifyURL:location.host,uuid:e,customerEmail:c,browserTrackId:t.clientId,activity:"view"}])}).then(I=>I.json());n.success?(yield g(`${e}_view`,a,30),yield g(`${e}_view_email`,c,30),yield g(a,e),yield u(t.clientId,"fbis_viewed",d,a,e,c)):console.error(n.message)}})),i.subscribe("product_added_to_cart",t=>p(y,null,function*(){console.log(t);let e=t.data.cartLine.merchandise.id,c=t.data.cartLine.merchandise.product.id,s=yield f(e),a=yield f(`${s}_view`),d=yield f(`${s}_view_email`),n=yield h(`${s}_cart`);if(console.log(s,a,d,!n,e,a==e),s&&!n&&a==e){let I=yield fetch(`${b}/api/customer_activity`,{method:"POST",body:JSON.stringify([{productId:c,variantId:t.data.cartLine.merchandise.id,shopifyURL:location.host,uuid:s,browserTrackId:t.clientId,customerEmail:d,activity:"add_to_cart"}])}).then(P=>P.json());I.success?(yield g(`${s}_cart`,e,30),yield u(t.clientId,"fbis_added_to_cart",c,e,s,d)):console.error(I.message)}else console.log("Add to Cart!!")})),i.subscribe("product_removed_from_cart",t=>{console.log("Product Removed!!",t)}),i.subscribe("checkout_completed",t=>p(y,null,function*(){let e=yield _(t.clientId,"fbis_added_to_cart");if(e){let c=[];e.forEach(a=>{c.push({productId:a.productId,variantId:a.variantId,shopifyURL:location.host,uuid:a.uuid,browserTrackId:t.clientId,customerEmail:a.email,activity:"completed"})});let s=yield fetch(`${b}/api/customer_activity`,{method:"POST",body:JSON.stringify(c)}).then(a=>a.json());yield x(t.clientId)}console.log(t)}));function l(t,e){let c=t.substring(1).split("&"),s={};return c.forEach(a=>{let[d,n]=a.split("=");s[d]=n}),s[e]}function g(t,e,c,s="/"){return p(this,null,function*(){let a=new Date;a.setTime(a.getTime()+c*24*60*60*1e3);let d="expires="+a.toUTCString();yield r.cookie.set(`${t}=${e}; ${d}; path=${s}`)})}function h(t){return p(this,null,function*(){let e=yield r.cookie.get(t);return e!=null&&e!=null&&e.length>0})}function f(t){return p(this,null,function*(){return yield r.cookie.get(t)})}function u(t,e,c,s,a,d){return p(this,null,function*(){try{let n=JSON.parse(yield r.sessionStorage.getItem(t))||{};n[e]||(n[e]=[]),n[e].push({uuid:a,productId:c,variantId:s,email:d}),yield r.sessionStorage.setItem(t,JSON.stringify(n))}catch(n){console.error("Data error",n)}})}function _(t,e){return p(this,null,function*(){let c=yield r.sessionStorage.getItem(t);if(c)return JSON.parse(c)[e]})}function x(t){return p(this,null,function*(){yield r.sessionStorage.removeItem(t)})}})});var Q=V(E());})();
