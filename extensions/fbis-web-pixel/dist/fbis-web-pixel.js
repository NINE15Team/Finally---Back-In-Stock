(()=>{var E=Object.create;var k=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var h=(c,r)=>()=>(c&&(r=c(c=0)),r);var J=(c,r)=>()=>(r||c((r={exports:{}}).exports,r),r.exports);var R=(c,r,a,l)=>{if(r&&typeof r=="object"||typeof r=="function")for(let d of j(r))!A.call(c,d)&&d!==a&&k(c,d,{get:()=>r[d],enumerable:!(l=P(r,d))||l.enumerable});return c};var C=(c,r,a)=>(a=c!=null?E(L(c)):{},R(r||!c||!c.__esModule?k(a,"default",{value:c,enumerable:!0}):a,c));var I=(c,r,a)=>new Promise((l,d)=>{var f=u=>{try{p(a.next(u))}catch(m){d(m)}},g=u=>{try{p(a.throw(u))}catch(m){d(m)}},p=u=>u.done?l(u.value):Promise.resolve(u.value).then(f,g);p((a=a.apply(c,r)).next())});var w,v=h(()=>{w="WebPixel::Render"});var y,O=h(()=>{v();y=c=>shopify.extend(w,c)});var T=h(()=>{O()});var $=h(()=>{T()});var N=J(_=>{"use strict";$();var S="https://finally-back-in-stock-dev-2db9466211f6.herokuapp.com";y(({configuration:c,analytics:r,browser:a,init:l})=>{r.subscribe("product_viewed",t=>I(_,null,function*(){console.log("i am changed",l,a);let o=d(l.context.document.location.search,"fbis");if(console.log(o),o)if(console.log("demo",t,g(`${o}_view`)),g(`${o}_view`))console.log("View!!");else{let e=t.data.productVariant.id,s=t.data.productVariant.product.id,i=yield fetch(`${S}/api/customer_activity`,{method:"POST",body:JSON.stringify([{productId:s,variantId:e,shopifyURL:location.host,uuid:o,browserTrackId:t.clientId,status:"view"}])}).then(n=>n.json());i.success?(f(`${o}_view`,e,30),f(e,o),u(t.clientId,"fbis_viewed",s,e,o)):console.error(i.message)}})),r.subscribe("product_added_to_cart",t=>I(_,null,function*(){console.log(t);let o=t.data.cartLine.merchandise.id,e=t.data.cartLine.merchandise.product.id,s=p(o),i=p(`${s}_view`);if(s&&!g(`${s}_cart`)&&i==o){let n=yield fetch(`${S}/api/customer_activity`,{method:"POST",body:JSON.stringify([{productId:e,variantId:t.data.cartLine.merchandise.id,shopifyURL:location.host,uuid:s,browserTrackId:t.clientId,status:"add_to_cart"}])}).then(b=>b.json());n.success?(f(`${s}_cart`,o,30),u(t.clientId,"fbis_added_to_cart",e,o,s)):console.error(n.message)}else console.log("Add to Cart!!")})),r.subscribe("product_removed_from_cart",t=>{console.log("Product Removed!!",t)}),r.subscribe("checkout_completed",t=>I(_,null,function*(){let o=m(t.clientId,"fbis_added_to_cart");if(o){let e=[];o.forEach(i=>{e.push({productId:i.productId,variantId:i.variantId,shopifyURL:location.host,uuid:i.uuid,browserTrackId:t.clientId,status:"completed"})});let s=yield fetch(`${S}/api/customer_activity`,{method:"POST",body:JSON.stringify(e)}).then(i=>i.json());x(t.clientId)}console.log(t)}));function d(t,o){let e=t.substring(1).split("&"),s={};return e.forEach(i=>{let[n,b]=i.split("=");s[n]=b}),s[o]}function f(t,o,e,s="/"){let i=new Date;i.setTime(i.getTime()+e*24*60*60*1e3);let n="expires="+i.toUTCString();document.cookie=`${t}=${o}; ${n}; path=${s}`}function g(t){let o=document.cookie.split("; ");for(let e=0;e<o.length;e++)if(o[e].split("=")[0]===t)return!0;return!1}function p(t){let o=t+"=",e=document.cookie.split(";");for(let s=0;s<e.length;s++){let i=e[s];for(;i.charAt(0)==" ";)i=i.substring(1,i.length);if(i.indexOf(o)==0)return i.substring(o.length,i.length)}return null}function u(t,o,e,s,i){try{let n=JSON.parse(sessionStorage.getItem(t))||{};n[o]||(n[o]=[]),n[o].push({uuid:i,productId:e,variantId:s}),sessionStorage.setItem(t,JSON.stringify(n))}catch(n){console.error("Data error",n)}}function m(t,o){let e=sessionStorage.getItem(t);if(e)return JSON.parse(e)[o]}function x(t){sessionStorage.removeItem(t)}})});var H=C(N());})();
