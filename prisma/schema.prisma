generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["relationJoins"]
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Session {
  id          String    @id
  shop        String
  state       String
  isOnline    Boolean   @default(false)
  scope       String?
  expires     DateTime?
  accessToken String
  userId      String?
}

model ShopifyStoreInfo {
  id                 Int                 @id @default(autoincrement())
  storeId            String              @map("store_id")
  storeName          String              @map("store_name")
  shopifyURL         String              @map("shopify_url")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @default(now()) @updatedAt @map("updated_at")
  isActive           Boolean             @default(true) @map("is_active")
  productInfo        ProductInfo[]
  EmailConfiguartion EmailConfiguartion?

  @@unique([shopifyURL])
  @@map("store_info")
}

model ProductInfo {
  id                   Int                    @id @default(autoincrement())
  storeId              Int                    @map("store_id")
  store                ShopifyStoreInfo       @relation(fields: [storeId], references: [id], onDelete: Cascade) // This establishes the relationship
  productHandle        String                 @map("product_handle")
  productId            String                 @map("product_id")
  productTitle         String                 @default("Default Product") @map("product_title")
  variantId            String                 @map("variant_id")
  variantTitle         String                 @default("Default Variant") @map("variant_title")
  price                Float                 @default(0) @map("price")
  imageURL             String                 @default("Default Variant") @map("image_url")
  status               Boolean                @default(false)
  inStock              Boolean                @default(false)
  createdAt            DateTime               @default(now()) @map("created_at")
  updatedAt            DateTime               @default(now()) @updatedAt @map("updated_at")
  isActive             Boolean                @default(true)
  customerSubscription CustomerSubscription[]

  @@unique([productId, variantId])
  @@map("product_info")
}

model CustomerSubscription {
  id            Int         @id @default(autoincrement())
  productInfoId Int         @map("product_info_id")
  productInfo   ProductInfo @relation(fields: [productInfoId], references: [id], onDelete: Cascade) // This establishes the relationship
  customerEmail String      @default("Default Email") @map("customer_email")
  customerTel   String      @default("") @map("customer_tel")
  status        Boolean     @default(false) @map("status")
  isNotified    Boolean     @default(false) @map("is_notified")
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @default(now()) @updatedAt @map("updated_at")
  isActive      Boolean     @default(true)

  @@unique([customerEmail, productInfoId])
  @@map("customer_subscription")
}

model EmailConfiguartion {
  id              Int              @id @default(autoincrement())
  storeId         Int              @map("store_id")
  store           ShopifyStoreInfo @relation(fields: [storeId], references: [id], onDelete: Cascade) // This establishes the relationship
  senderEmail     String           @default("") @map("sender_email")
  title           String           @default("") @map("email_title")
  senderId        Int              @default(0) @map("sender_id")
  isEmailVerified String           @default("NO") @map("email_verified")
  headerContent   String           @default("") @map("header_content")
  bodyContent     String           @default("") @map("body_content")
  footerContent   String           @default("") @map("footer_content")
  buttonContent   String           @default("") @map("button_content")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @default(now()) @updatedAt @map("updated_at")

  @@unique([storeId])
  @@map("email_configuartion")
}
